---
title: "ğŸ“š 2. JPA ì‹œì‘"
description: "JPA ì±… ì •ë¦¬"
date: 2022-03-05
update: 2022-03-05
tags:
  - Java
  - JPA
  - SpringBoot
series: "ğŸ“š ORM í‘œì¤€ JPA"
---

<em>[ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë° - ê¹€ì˜í•œ]ì„ ì½ê³  ì¸ìš©í•˜ê³  ì •ë¦¬í•˜ëŠ” POSTì…ë‹ˆë‹¤.</em>

## ğŸ’« í”„ë¡œì íŠ¸ ê°œë°œ íˆ´ ì„¤ì¹˜ì™€ í”„ë¡œì íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°
Intellijë¥¼ ì‚¬ìš©í•˜ì—¬ ê°„ë‹¨í•œ JPA ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ ê²ƒì´ë‹¤. ê·¸ë¦¬ê³  ì˜ˆì œ í”„ë¡œì íŠ¸ëŠ” https://github.com/holyeye/jpabook ì—ì„œ ë‹¤ìš´ë°›ì„ ìˆ˜ ìˆë‹¤. ì´ ê³¼ì •ì€ ìƒëµí•˜ë„ë¡ í•œë‹¤! ê·¸ë¦¬ê³  `ch02-jpa-start1` ì—ì„œë¶€í„° í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ë„ë¡ í•œë‹¤. 

ë˜í•œ ì„¤ì¹˜ê°€ í•„ìš”ì—†ê³  ìš©ëŸ‰ë„ ê°€ë²¼ìš´ H2 ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì„¤ì¹˜í•˜ì—¬ ì‚¬ìš©í•˜ë„ë¡ í•œë‹¤. ì„¤ì¹˜ ê³¼ì •ì€ ìƒëµí•˜ê³ , `bin/h2.sh` ëª…ë ¹ì–´ë¡œ H2 ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì„œë²„ ëª¨ë“œë¡œ ì‹¤í–‰í•œë‹¤.

> ğŸ“Œ H2 ë°ì´í„°ë² ì´ìŠ¤ëŠ” JVM ë©”ëª¨ë¦¬ ì•ˆì—ì„œ ì‹¤í–‰ë˜ëŠ” **ì„ë² ë””ë“œ ëª¨ë“œ**ì™€, ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì²˜ëŸ¼ ë³„ë„ì˜ ì„œë²„ë¥¼ ë„ì›Œ ë™ì‘í•˜ëŠ” **ì„œë²„ ëª¨ë“œ**ê°€ ìˆë‹¤.
> - **ì„ë² ë””ë“œ ëª¨ë“œ**
>   - applicationì´ ì¢…ë£Œëœë‹¤ë©´ ì €ì¥, ìˆ˜ì •ëœ Dataê°€ ì†ì‹¤(íœ˜ë°œ)ë˜ì–´ ê¸°ë³¸ì ìœ¼ë¡œëŠ” ì˜ì†ì ì´ì§€ ì•Šì€ ë°©ì‹
>   - ë©”ì¸ ë©”ëª¨ë¦¬ì— ë„ì›Œë†“ê³  ì‚¬ìš©í•˜ê¸°ì— ë°ì´í„° ì ‘ê·¼ì´ ë§¤ìš° ë¹ ë¦„
> - **ì„œë²„ ëª¨ë“œ**
>   - ë³„ë„ì˜ í”„ë¡œì„¸ìŠ¤ë¡œ DBë¥¼ ë™ì‘ì‹œí‚¤ëŠ” ë°©ì‹
>   - ëª¨ë“  ë°ì´í„°ì˜ ì²˜ë¦¬ íë¦„ì´ TCP/IPë¥¼ í†µí•˜ì—¬ ì „ì†¡ë˜ê¸° ë•Œë¬¸ì— Embedded ëª¨ë“œë³´ë‹¤ ìƒëŒ€ì ìœ¼ë¡œ ëŠë¦¼

ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‹¤í–‰í•œ í›„ ì‚¬ìš©í•  ì˜ˆì œ í…Œì´ë¸”ì„ ì•„ë˜ì˜ DDLë¡œ ìƒì„±í•œë‹¤.
```sql
CREATE TABLE MEMBER (
    ID VARCHAR(255) NOT NULL,
    NAME VARCHAR(255),
    AGE INTEGER NOT NULL,
    PRIMARY KEY(ID)
)
```

---

## ğŸ’« ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ í”„ë¡œì íŠ¸ êµ¬ì¡°
ì—¬ê¸°ì„œëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ê´€ë¦¬ ë„êµ¬ë¡œì„œ ë©”ì´ë¸ì„ ì‚¬ìš©í•œë‹¤. ê·¸ë¦¬ê³  ì±… ì „ë°˜ì— ê±¸ì³ì„œ JPA êµ¬í˜„ì²´ë¡œ Hibernateë¥¼ ì‚¬ìš©í•œë‹¤. í•µì‹¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œëŠ” `hibernate-core` , `hibernate-entitymanager` , `hibernate-jpa-2.1-api` ë¥¼ ì‚¬ìš©í•œë‹¤.

> `hibernate-entitymanager` ë¥¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ì§€ì •í•˜ë©´, ë‚˜ë¨¸ì§€ 2ê°œì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë„ í•¨ê»˜ ë‚´ë ¤ë°›ëŠ”ë‹¤.

### â° ë©”ì´ë¸ê³¼ ì‚¬ìš© ë¼ì´ë¸ŒëŸ¬ë¦¬ ê´€ë¦¬
> **ë©”ì´ë¸**ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê´€ë¦¬ ê¸°ëŠ¥ê³¼ ë¹Œë“œ ê¸°ëŠ¥ì„ ì œê³µí•¨ìœ¼ë¡œì¨, ìë°” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê´€ë¦¬í•´ì£¼ëŠ” ë„êµ¬ì´ë‹¤.
> - **ë¼ì´ë¸ŒëŸ¬ë¦¬ ê´€ë¦¬ ê¸°ëŠ¥**
>   - ìë°” ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì— í•„ìš”í•œ jar ë¼ì´ë¸ŒëŸ¬ë¦¬ íŒŒì¼ë“¤ì„ ìë™ìœ¼ë¡œ ë‚´ë ¤ë°›ê³  ê´€ë¦¬í•´ì£¼ëŠ” ê¸°ëŠ¥ 
> - **ë¹Œë“œ ê¸°ëŠ¥**
>   - ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì§ì ‘ ë¹Œë“œí•˜ëŠ” ê³ ëœ ì‘ì—…ì´ ì•„ë‹Œ í‘œì¤€í™”ëœ ë°©ë²•ì„ ì œê³µí•œë‹¤.

ë©”ì´ë¸ ì„¤ì • íŒŒì¼(`pom.xml`)ì„ ë³´ë©´, `<dependencies>` ì— ì‚¬ìš©í•  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì§€ì •í•´ì£¼ê³  ìˆë‹¤. `groupId + artifactId + version` ë§Œ ëª…ì‹œí•˜ì—¬ ë¼ì´ë¸ŒëŸ¬ë¦¬(jar íŒŒì¼)ì„ ë‚´ë ¤ë°›ì•„ ì¶”ê°€í•œë‹¤.

---

## ğŸ’« ê°ì²´ ë§¤í•‘ ì‹œì‘
ì•„ê¹Œ ìƒì„±í•œ í…Œì´ë¸”ì„ í† ëŒ€ë¡œ, ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©í•  íšŒì› í´ë˜ìŠ¤ë¥¼ ë§Œë“ ë‹¤.

```java
public class Member {

    private String id;

    private String username;

    private Integer age;

    public String getId() {
        return id;
    }

    public void setId(String id) {
        this.id = id;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }
}
```

JPAë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ë¨¼ì € íšŒì› í´ë˜ìŠ¤ì™€ íšŒì› í…Œì´ë¸”ì„ ë§¤í•‘í•´ì•¼ í•œë‹¤. (ê°ì²´ì™€ í…Œì´ë¸” ê°„ ë§¤í•‘) ë‹¤ìŒ í‘œë¥¼ ì°¸ê³ í•´ ë‘˜ì„ ë¹„êµí•˜ë©´ì„œ ë§¤í•‘ì„ ìˆ˜í–‰í•œë‹¤.

|ë§¤í•‘ ì •ë³´|íšŒì› ê°ì²´|íšŒì› í…Œì´ë¸”|
|---|---|---|
|í´ë˜ìŠ¤ì™€ í…Œì´ë¸”|`Member`|`MEMBER`|
|ê¸°ë³¸ í‚¤|`id`|`ID`|
|í•„ë“œì™€ ì»¬ëŸ¼|`username`|`NAME`|
|í•„ë“œì™€ ì»¬ëŸ¼|`age`|`AGE`|

ìœ„ í‘œë¥¼ ì°¸ê³ í•´ JPAê°€ ì œê³µí•˜ëŠ” ë§¤í•‘ annotationì„ ì ìš©í•œë‹¤.

```java
import javax.persistence.*;

@Entity
@Table(name="MEMBER")
public class Member {

    @Id
    @Column(name = "ID")
    private String id;

    @Column(name = "NAME")
    private String username;

    private Integer age;

    public String getId() {
        return id;
    }

    public void setId(String id) {
        this.id = id;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }
}
```

**`@Entity`**
- í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ í…Œì´ë¸”ê³¼ ë§¤í•‘í•œë‹¤ê³  ëª…ì‹œí•œë‹¤. ì´ í´ë˜ìŠ¤ë¥¼ ì—”í‹°í‹° í´ë˜ìŠ¤ë¼ê³  í•œë‹¤.

**`@Table`**
- ì—”í‹°í‹° í´ë˜ìŠ¤ì— ë§¤í•‘í•  í…Œì´ë¸” ì •ë³´ë¥¼ ì•Œë ¤ì¤€ë‹¤. ìœ„ ì˜ˆì‹œì—ì„œëŠ” `name` ì†ì„±ì„ ì‚¬ìš©í•´ `Member` entityë¥¼ `MEMBER` í…Œì´ë¸”ì— ë§¤í•‘í–ˆë‹¤. 
- í•´ë‹¹ annotationì´ ì—†ë‹¤ë©´ í´ë˜ìŠ¤ ì´ë¦„ì„ í…Œì´ë¸” ì´ë¦„ìœ¼ë¡œ ë§¤í•‘í•œë‹¤. (ì •í™•íˆëŠ” ì—”í‹°í‹° ì´ë¦„ì„ ì‚¬ìš©í•œë‹¤.)

**`@Id`**
- ì—”í‹°í‹° í´ë˜ìŠ¤ì˜ í•„ë“œë¥¼ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ì— ë§¤í•‘í•œë‹¤. ìœ„ ì˜ˆì‹œì—ì„œëŠ” ì—”í‹°í‹°ì˜ `id` í•„ë“œë¥¼ í…Œì´ë¸”ì˜ `ID` ê¸°ë³¸ í‚¤ ì»¬ëŸ¼ì— ë§¤í•‘í–ˆë‹¤.
- ì´ í•„ë“œë¥¼ ì‹ë³„ì í•„ë“œë¼ê³  í•œë‹¤.

**`@Column`** 
- í•„ë“œë¥¼ ì»¬ëŸ¼ì— ë§¤í•‘í•œë‹¤. ìœ„ ì˜ˆì‹œì—ì„œëŠ” `name` ì†ì„±ì„ ì‚¬ìš©í•´ `Member` entityì˜ `username` í•„ë“œë¥¼ `MEMBER` í…Œì´ë¸”ì˜ `NAME` ì»¬ëŸ¼ì— ë§¤í•‘í–ˆë‹¤.

**ë§¤í•‘ ì •ë³´ê°€ ì—†ëŠ” í•„ë“œ**
- ë§¤í•‘ annotationì„ ìƒëµí•˜ë©´ í•„ë“œëª…ì„ ì‚¬ìš©í•´ ì»¬ëŸ¼ëª…ìœ¼ë¡œ ë§¤í•‘í•œë‹¤. ì—¬ê¸°ì„œëŠ” ë°ì´í„°ë² ì´ìŠ¤ê°€ ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•˜ê¸° ì•ŠëŠ”ë‹¤ê³  ê°€ì •í•˜ì—¬ `age` í•„ë“œê°€ `age` ì»¬ëŸ¼ìœ¼ë¡œ ë§¤í•‘ëœë‹¤.
  - ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•œë‹¤ë©´ `@Column(name="AGE")` ë¡œ ëª…ì‹œí•´ì•¼ í•œë‹¤.

---

## ğŸ’« `persistence.xml` ì„¤ì •
JPAëŠ” `persistence.xml` ì„ ì‚¬ìš©í•´ì„œ í•„ìš”í•œ ì„¤ì • ì •ë³´ë¥¼ ê´€ë¦¬í•œë‹¤. ì´ ì„¤ì • íŒŒì¼ì€ `META-INF/persistence.xml` í´ë˜ìŠ¤ íŒ¨ìŠ¤ ê²½ë¡œì— ìˆì–´ì•¼ ë³„ë„ì˜ ì„¤ì • ì—†ì´ JPAê°€ ì¸ì‹í•œë‹¤.

```xml
<persistence xmlns="http://xmlns.jcp.org/xml/ns/persistence" version="2.1">
```
- ì„¤ì • íŒŒì¼ì€ `persistence` ë¡œ ì‹œì‘í•œë‹¤. ì—¬ê¸°ì— XML namespace(ns)ì™€ ì‚¬ìš©í•  ë²„ì „ì„ ì§€ì •í•œë‹¤.

```xml
<persistence-unit name="jpabook">
```
- JPA ì„¤ì •ì€ ì˜ì†ì„± ìœ ë‹›(`persistence-unit`)ì´ë¼ëŠ” ê²ƒë¶€í„° ì‹œì‘í•˜ëŠ”ë°, ì¼ë°˜ì ìœ¼ë¡œ ì—°ê²°í•  ë°ì´í„°ë² ì´ìŠ¤ë‹¹ í•˜ë‚˜ì˜ ì˜ì†ì„± ìœ ë‹›ì„ ë“±ë¡í•œë‹¤. 
- ê·¸ë¦¬ê³  ì˜ì†ì„± ìœ ë‹›ì€ ê³ ìœ í•œ ì´ë¦„ì´ í•„ìš”í•´ `jpabook` ì„ ì‚¬ìš©í–ˆë‹¤.

ì•„ë˜ì—ëŠ” JPA í‘œì¤€ ì†ì„±ê³¼ Hibernate ì†ì„±ì´ ì°¨ë¡€ë¡œ ìœ„ì¹˜í•œë‹¤.
- ì´ë¦„ì´ `javax.persistence` ë¡œ ì‹œì‘í•˜ëŠ” JPA í‘œì¤€ ì†ì„±ì€ íŠ¹ì • êµ¬í˜„ì²´ ì¢…ì†ë˜ì§€ ì•ŠëŠ”ë‹¤. 
- í•˜ì§€ë§Œ `hibernate` ë¡œ ì‹œì‘í•˜ëŠ” ì†ì„±ì€ Hibernate ì „ìš© ì†ì„±ìœ¼ë¡œ Hibernateì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
  - ê°€ì¥ ì¤‘ìš”í•œ ì†ì„±ì€ ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸ì„ ì„¤ì •í•˜ëŠ” `hibernate.dialect` ì´ë‹¤.

### â° ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸
> JPAëŠ” íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì— ì¢…ì†ì ì´ì§€ ì•Šì€ ê¸°ìˆ ì´ë‹¤.

ë”°ë¼ì„œ ë‹¤ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ì†ì‰½ê²Œ êµì²´í•  ìˆ˜ ìˆëŠ”ë°, ê° ë°ì´í„°ë² ì´ìŠ¤ê°€ ì œê³µí•˜ëŠ” ë¬¸ë²•ê³¼ í•¨ìˆ˜ê°€ ì¡°ê¸ˆì”© ë‹¤ë¥¸ ë¬¸ì œê°€ ìˆë‹¤.
- ë°ì´í„° íƒ€ì… : `VARCHAR` vs. `VARCHAR2`
- ë‹¤ë¥¸ í•¨ìˆ˜ëª… : `SUBSTRING()` vs. `SUBSTR()`
- í˜ì´ì§• ì²˜ë¦¬ : `LIMIT` vs. `ROWNUM`

ì´ì²˜ëŸ¼ SQL í‘œì¤€ì„ ì§€í‚¤ì§€ ì•Šê±°ë‚˜, íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ë§Œì˜ ê³ ìœ í•œ ê¸°ëŠ¥ì„ JPAì—ì„œëŠ” **ë°©ì–¸(dialect)**ì´ë¼ í•œë‹¤.
- ë‹¹ì—°íˆ ì´ëŸ° ê²½ìš°ê°€ ë§ì•„ì§€ë©´, ì¶”í›„ ë°ì´í„°ë² ì´ìŠ¤ì˜ ë³€ê²½ì„ ì–´ë µê²Œ í•œë‹¤.
- ëŒ€ë¶€ë¶„ì˜ JPA êµ¬í˜„ì²´ë“¤ì€ ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë‹¤ì–‘í•œ ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸ í´ë˜ìŠ¤ë¥¼ ì œê³µí•œë‹¤.

**ì–´ë–»ê²Œ ì ìš©ì´ ë˜ëŠëƒ?**
- ê°œë°œìëŠ” JPAê°€ ì œê³µí•˜ëŠ” í‘œì¤€ ë¬¸ë²•ì— ë§ì¶° JPAë¥¼ ì‚¬ìš©í•œë‹¤.
- íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì— ì˜ì¡´ì ì¸ SQLì€ ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸ì´ ì²˜ë¦¬í•œë‹¤.

ë”°ë¼ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œì˜ ë³€ê²½ì´ ì•„ë‹Œ ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸ì˜ ë³€ê²½ìœ¼ë¡œ ì ìš©ëœë‹¤!

HibernateëŠ” ëŒ€í‘œì ìœ¼ë¡œ `H2` , `ì˜¤ë¼í´ 10g` , `MySQL` ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸ì„ ì œê³µí•œë‹¤. ì—¬ê¸°ì„œ H2 ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê¸°ì— `dialect` ì†ì„±ì„ `H2Dialect` ë¡œ ì„¤ì •í–ˆë‹¤.

---

## ğŸ’« ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ
`JpaMain` ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹œì‘í•˜ëŠ” ì½”ë“œì´ë‹¤.

```java
public class JpaMain {

    public static void main(String[] args) {

        //ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ ìƒì„±
        EntityManagerFactory emf = Persistence.createEntityManagerFactory("jpabook");
        EntityManager em = emf.createEntityManager(); //ì—”í‹°í‹° ë§¤ë‹ˆì € ìƒì„±

        EntityTransaction tx = em.getTransaction(); //íŠ¸ëœì­ì…˜ ê¸°ëŠ¥ íšë“

        try {
            tx.begin(); //íŠ¸ëœì­ì…˜ ì‹œì‘
            logic(em);  //ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
            tx.commit();//íŠ¸ëœì­ì…˜ ì»¤ë°‹

        } catch (Exception e) {
            e.printStackTrace();
            tx.rollback(); //íŠ¸ëœì­ì…˜ ë¡¤ë°±
        } finally {
            em.close(); //ì—”í‹°í‹° ë§¤ë‹ˆì € ì¢…ë£Œ
        }

        emf.close(); //ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ ì¢…ë£Œ
    }

    public static void logic(EntityManager em) {

        String id = "id1";
        Member member = new Member();
        member.setId(id);
        member.setUsername("ì§€í•œ");
        member.setAge(2);

        //ë“±ë¡
        em.persist(member);

        //ìˆ˜ì •
        member.setAge(20);

        //í•œ ê±´ ì¡°íšŒ
        Member findMember = em.find(Member.class, id);
        System.out.println("findMember=" + findMember.getUsername() + ", age=" + findMember.getAge());

        //ëª©ë¡ ì¡°íšŒ
        List<Member> members = em.createQuery("select m from Member m", Member.class).getResultList();
        System.out.println("members.size=" + members.size());

        //ì‚­ì œ
        em.remove(member);
    }
}
```

ì½”ë“œëŠ” í¬ê²Œ 3ë¶€ë¶„ìœ¼ë¡œ ë‚˜ë‰œë‹¤.
- ì—”í‹°í‹° ë§¤ë‹ˆì € ì„¤ì •
- íŠ¸ëœì­ì…˜ ê´€ë¦¬
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§

### â° ì—”í‹°í‹° ë§¤ë‹ˆì € ì„¤ì •
íë¦„ì€
1. `Persistence` ê°€ `META-INF/persistence.xml` ì—ì„œ ì„¤ì • ì •ë³´ë¥¼ ì¡°íšŒí•œë‹¤.
2. ì¡°íšŒí•œ ì„¤ì • ì •ë³´ë¥¼ ê°€ì§€ê³  `EntityManageFactory` ë¥¼ ìƒì„±í•œë‹¤.
3. `EntityManagerFactory` ëŠ” `EntityManager` ë¥¼ ìƒì„±í•œë‹¤.

**ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ ìƒì„±**
- JPAë¥¼ ì‹œì‘í•˜ë ¤ë©´ `persistence.xml` ì˜ ì„¤ì • ì •ë³´ë¥¼ ì‚¬ìš©í•´ ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤. ì´ë•Œ `Persistence` í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤.

```java
EntityManagerFactory emf = Persistence.createEntityManagerFactory("jpabook");
```
- ì„¤ì • íŒŒì¼ì—ì„œ ì´ë¦„ì´ `jpabook` ì¸ ì˜ì†ì„± ìœ ë‹›ì„ ì°¾ì•„ ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ë¥¼ ìƒì„±í•œë‹¤. 
- ì´ë•Œ ì„¤ì • íŒŒì¼ì˜ ì„¤ì • ì •ë³´ë¥¼ ì½ì–´ JPAë¥¼ ë™ì‘ì‹œí‚¤ê¸° ìœ„í•œ ê¸°ë°˜ ê°ì²´ë¥¼ ë§Œë“¤ê³  JPAì— ë”°ë¼ì„œëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ í’€ë„ ìƒì„±í•˜ë¯€ë¡œ **ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ë¥¼ ìƒì„±í•˜ëŠ” í•˜ëŠ” ë¹„ìš©ì€ ì•„ì£¼ í¬ë‹¤.**

> "ë”°ë¼ì„œ ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì—ì„œ **ë”± 1ë²ˆë§Œ ìƒì„±**í•˜ê³ , **ê³µìœ **í•´ì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤."

**ì—”í‹°í‹° ë§¤ë‹ˆì € ìƒì„±**
```java
EntityManager em = emf.createEntityManager();
```
- ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ì—ì„œ ì—”í‹°í‹° ë§¤ë‹ˆì €ë¥¼ ìƒì„±í•œë‹¤. JPAì´ ëŒ€ë¶€ë¶„ì˜ ê¸°ëŠ¥ì€ ì´ ì—”í‹°í‹° ë§¤ë‹ˆì €ê°€ ì œê³µí•œë‹¤.
- ëŒ€í‘œì ìœ¼ë¡œ ì—”í‹°í‹°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— **ë“±ë¡/ìˆ˜ì •/ì‚­ì œ/ì¡°íšŒ**í•˜ëŠ” ê¸°ëŠ¥ì´ ìˆë‹¤.
- ì—”í‹°í‹° ë§¤ë‹ˆì €ëŠ” ë‚´ë¶€ì— ë°ì´í„°ë² ì´ìŠ¤(ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜)ë¥¼ ìœ ì§€í•˜ë©´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì™€ í†µì‹ í•œë‹¤. ë”°ë¼ì„œ ê°€ìƒì˜ ë°ì´í„°ë² ì´ìŠ¤ë¼ê³  ìƒê°í•  ìˆ˜ë„ ìˆë‹¤.

> "ì—”í‹°í‹° ë§¤ë‹ˆì €ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ê³¼ ë°€ì ‘í•œ ê´€ê³„ë¥¼ ê°€ì§€ë¯€ë¡œ **ìŠ¤ë ˆë“œ ê°„ ê³µìœ í•˜ê±°ë‚˜ ì¬ì‚¬ìš©í•´ì„œëŠ” ì•ˆëœë‹¤.**"

**ì¢…ë£Œ**<br/>
ì‚¬ìš©ì´ ëë‚œ ì—”í‹°í‹° ë§¤ë‹ˆì €ì™€, ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì¢…ë£Œë  ë•Œ ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ë¥¼ ë°˜ë“œì‹œ ì¢…ë£Œí•´ì•¼ í•œë‹¤.

```java
em.close();
...

emf.close();
```

### â° íŠ¸ëœì­ì…˜ ê´€ë¦¬
JPAë¥¼ ì‚¬ìš©í•˜ë©´ í•­ìƒ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ë°ì´í„°ë¥¼ ë³€ê²½í•´ì•¼ í•œë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ë°ì´í„°ë² ì´ìŠ¤ì˜ ì¼ê´€ì„±ì„ êº íŠ¸ë¦´ ìˆ˜ ìˆê³  ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.
- íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ë ¤ë©´ ì—”í‹°í‹° ë§¤ë‹ˆì €(`em`)ì—ì„œ íŠ¸ëœì­ì…˜ APIë¥¼ ë°›ì•„ì™€ì•¼ í•œë‹¤.
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì •ìƒ ë™ì‘í•˜ë©´ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ê³ , ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ë¡¤ë°±í•œë‹¤.

```java
try {
    tx.begin(); //íŠ¸ëœì­ì…˜ ì‹œì‘
    logic(em);  //ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    tx.commit();//íŠ¸ëœì­ì…˜ ì»¤ë°‹

} catch (Exception e) {
    e.printStackTrace();
    tx.rollback(); //íŠ¸ëœì­ì…˜ ë¡¤ë°±
}
```

### â° ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ íšŒì› ì—”í‹°í‹°ë¥¼ í•˜ë‚˜ ìƒì„±í•œ í›„ ì—”í‹°í‹° ë§¤ë‹ˆì €ë¥¼ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ì— ë“±ë¡, ìˆ˜ì •, ì‚­ì œ, ì¡°íšŒí•œë‹¤.

> ëª¨ë“  ê¸°ëŠ¥ì´ ì—”í‹°í‹° ë§¤ë‹ˆì €ë¥¼ í†µí•´ ìˆ˜í–‰ë˜ì–´ ê°ì²´ë¥¼ ì €ì¥í•˜ëŠ” ê°€ìƒì˜ ë°ì´í„°ë² ì´ìŠ¤ì²˜ëŸ¼ ë³´ì¸ë‹¤.

```java
public static void logic(EntityManager em) {

    String id = "id1";
    Member member = new Member();
    member.setId(id);
    member.setUsername("ì§€í•œ");
    member.setAge(2);

    //ë“±ë¡
    em.persist(member);

    //ìˆ˜ì •
    member.setAge(20);

    //í•œ ê±´ ì¡°íšŒ
    Member findMember = em.find(Member.class, id);
    System.out.println("findMember=" + findMember.getUsername() + ", age=" + findMember.getAge());

    //ëª©ë¡ ì¡°íšŒ
    List<Member> members = em.createQuery("select m from Member m", Member.class).getResultList();
    System.out.println("members.size=" + members.size());

    //ì‚­ì œ
    em.remove(member);
}
```

**ë“±ë¡**
- ì—”í‹°í‹°ì˜ ì €ì¥ì€ `persist()` ë©”ì†Œë“œì— ì €ì¥í•  ì—”í‹°í‹°ë¥¼ ë„˜ê²¨ì£¼ê¸°ë§Œ í•˜ë©´ ëœë‹¤.
- ì´ë•Œ JPAëŠ” íšŒì› ì—”í‹°í‹°ì˜ ë§¤í•‘ ì •ë³´(annotation)ë¥¼ ë¶„ì„í•´ INSERT SQLì„ ë§Œë“¤ì–´ ë°ì´í„°ë² ì´ìŠ¤ì— ì „ë‹¬í•œë‹¤.

```sql
INSERT INTO MEMBER (ID, NAME, AGE) VALUES ('id1' , 'ì§€í•œ', 2)
```

**ìˆ˜ì •**
- ìˆ˜ì •ì€ ì¡°ê¸ˆ ì´ìƒí•´ë³´ì¸ë‹¤. ì—”í‹°í‹° ìˆ˜ì • í›„ ìˆ˜ì •ëœ ë‚´ìš©ì„ ë°˜ì˜í•´ì£¼ëŠ” `em.update()` ê°™ì€ ë©”ì†Œë“œê°€ í•„ìš”í•  ê²ƒ ê°™ì€ë°, ê·¸ì € ê°’ë§Œ ë³€ê²½í•˜ê³  ë§ì•˜ë‹¤.
- JPAëŠ” ì–´ë–¤ ì—”í‹°í‹°ê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€ ì¶”ì í•˜ëŠ” ê¸°ëŠ¥ì´ ìˆë‹¤. ë”°ë¼ì„œ `member.setAge(20)` ì²˜ëŸ¼ ê°’ë§Œ ë³€ê²½í•˜ë©´ UPDATE SQLì„ ìƒì„±í•´ ë°ì´í„°ë² ì´ìŠ¤ì— ì „ë‹¬í•œë‹¤.

```sql
UPDATE MEMBER SET AGE=20, NAME='ì§€í•œ' WHERE ID='id1'
```

**ì‚­ì œ**
- ì—”í‹°í‹°ë¥¼ ì‚­ì œí•˜ë ¤ë©´ `remove()` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ë˜ê³ , ì´ ì—­ì‹œ JPAì—ì„œ DELETE SQLì„ ìƒì„±í•´ ë°ì´í„°ë² ì´ìŠ¤ì— ì „ë‹¬í•œë‹¤.

```sql
DELETE FROM MEMBER WHERE ID='id1'
```

**í•œ ê±´ ì¡°íšŒ**
- í•œ ê±´ ì¡°íšŒë¥¼ ìœ„í•´ ì‚¬ìš©í•˜ëŠ” `find()` ë©”ì†Œë“œëŠ” ì¡°íšŒí•  ì—”í‹°í‹° íƒ€ì…ê³¼ `@Id` ë¡œ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ì™€ ë§¤í•‘í•œ ì‹ë³„ì ê°’ìœ¼ë¡œ ì—”í‹°í‹° í•˜ë‚˜ë¥¼ ì¡°íšŒí•œë‹¤.
- ì—­ì‹œë‚˜ SELECT SQLì„ ìƒì„±í•˜ê³ , ì¡°íšŒí•œ ê²°ê³¼ ê°’ìœ¼ë¡œ ì—”í‹°í‹°ë¥¼ ìƒì„±í•´ ë°˜í™˜í•œë‹¤.

```sql
SELECT * FROM MEMBER WHERE ID='id1'
```

### â° JPQL
JPAë¥¼ ì‚¬ìš©í•˜ë©´ ê°œë°œìëŠ” ì—”í‹°í‹° ê°ì²´ ì¤‘ì‹¬ìœ¼ë¡œ ê°œë°œí•˜ê³ , ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•œ ì²˜ë¦¬ëŠ” JPAê°€ ìˆ˜í–‰í•˜ê²Œ ëœë‹¤. 

ë¬¸ì œëŠ” **ê²€ìƒ‰ ì¿¼ë¦¬**ë‹¤. JPAëŠ” ì—”í‹°í‹° ê°ì²´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê°œë°œí•˜ë¯€ë¡œ ê²€ìƒ‰ ì‹œì—ë„ í…Œì´ë¸”ì´ ì•„ë‹Œ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰í•´ì•¼ í•œë‹¤.

ê·¸ëŸ°ë° ì´ëŸ¬í•œ ê²€ìƒ‰ ë°©ì‹ì€ ë°ì´í„°ë² ì´ìŠ¤ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ë¶ˆëŸ¬ì™€ ì—”í‹°í‹° ê°ì²´ë¡œ ë³€ê²½í•œ ë‹¤ìŒ ê²€ìƒ‰í•´ì•¼ í•´ì„œ ì‚¬ì‹¤ìƒ ë¶ˆê°€ëŠ¥í•˜ë‹¤. ê²°êµ­ í•˜ë‚˜ ì´ìƒì˜ íšŒì› ëª©ë¡ì„ ì¡°íšŒí•˜ëŠ” ê²ƒê³¼ ê°™ì€ ê²½ìš°ëŠ” ê²€ìƒ‰ ì¡°ê±´ì´ í¬í•¨ëœ SQLì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

> "JPAëŠ” **JPQL(Java Persistence Query Language)**ì´ë¼ëŠ” SQLì„ ì¶”ìƒí™”í•œ ì¿¼ë¦¬ ì–¸ì–´ë¡œ ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•œë‹¤."
- ë¬¸ë²•ì€ SQLê³¼ ê±°ì˜ ìœ ì‚¬í•˜ì§€ë§Œ, ê°€ì¥ í° ì°¨ì´ì ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
  - JPQLì€ **ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒ**ìœ¼ë¡œ ì¿¼ë¦¬í•œë‹¤. ì¦‰ í´ë˜ìŠ¤ì™€ í•„ë“œë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬í•œë‹¤.
  - SQLì€ **ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì„ ëŒ€ìƒ**ìœ¼ë¡œ ì¿¼ë¦¬í•œë‹¤.

```java
select m from Member m
```
- ì—¬ê¸°ì„œ `from Member` ëŠ” íšŒì› ì—”í‹°í‹° ê°ì²´ë¥¼ ë§í•˜ëŠ” ê²ƒì´ì§€ ë°ì´í„°ë² ì´ìŠ¤ì˜ `MEMBER` í…Œì´ë¸”ì„ ë§í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë‹¤.
  - **"JPQLëŠ” ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì„ ì „í˜€ ì•Œì§€ ëª»í•œë‹¤."**
- `em.createQuery(JPQL, ë°˜í™˜ íƒ€ì…)` ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•´ í€´ë¦¬ ê°ì²´ë¥¼ ìƒì„±í•˜ê³ ,
- ì¿¼ë¦¬ ê°ì²´ì˜ `getResultList()` ë©”ì†Œë¥¼ í˜¸ì¶œí•˜ì—¬ JPQLì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- JPAëŠ” JPQLì„ ë¶„ì„í•´ ì ì ˆí•œ SQLì„ ìƒì„±í•´ ë°ì´í„°ë² ì´ìŠ¤ì— ì „ë‹¬í•œë‹¤.

## ğŸ“• ì¶œì²˜
- **ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë°** - ê¹€ì˜í•œ
- [H2 DB ëª¨ë“œ](https://lob-dev.tistory.com/entry/H2%EC%9D%98-LocalIn-Memory-%EC%99%80-ServerTCP-%EB%AA%A8%EB%93%9C)